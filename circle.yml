machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - lsb_release -a
    - docker --version
    - docker info
    - ls -latrh ~/docker
    - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar && echo 'docker load'; fi
    - docker build -t vikingco/docker-buildcache:latest .
    - mkdir -p ~/docker; docker save vikingco/docker-buildcache:latest > ~/docker/image.tar
    - ls -latrh ~/docker
    - tar tf ~/docker/image.tar | awk -F/ '{if (NF<3) print }'

deployment:
  default:
    branch: /.*/
    commands:
      - echo 'deploy'

test:
  override:
      - echo 'override test'
  post:
      - echo 'post test'
